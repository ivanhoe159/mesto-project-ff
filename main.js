(()=>{"use strict";function e(e,n,r){var c=e.content.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),i=c.querySelector(".card__like-counter"),l=c.querySelector(".card__image");return l.src=n.link,l.alt=n.name,"1cebd42a12c2c9befb1391c9"!=n.owner._id&&(a.style.visibility="hidden"),n.likes.find((function(e){return"1cebd42a12c2c9befb1391c9"==e._id}))&&u.classList.toggle("card__like-button_is-active"),c.querySelector(".card__title").textContent=n.name,a.addEventListener("click",(function(){t(c,n._id)})),u.addEventListener("click",(function(){o(u,i,n._id)})),i.textContent=n.likes.length,l.addEventListener("click",(function(){return r(n)})),c}var t=function(e,t){return e.remove(),fetch("https://nomoreparties.co/v1/wff-cohort-6/cards/".concat(t),{method:"DELETE",headers:{authorization:"14623f3a-7681-4149-84a8-6e2abb29c429"}})},o=function(e,t,o){return e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?fetch("https://nomoreparties.co/v1/wff-cohort-6/cards/likes/".concat(o),{method:"PUT",headers:{authorization:"14623f3a-7681-4149-84a8-6e2abb29c429"}}).then((function(e){return e.json()})).then((function(e){t.textContent=e.likes.length})):fetch("https://nomoreparties.co/v1/wff-cohort-6/cards/likes/".concat(o),{method:"DELETE",headers:{authorization:"14623f3a-7681-4149-84a8-6e2abb29c429"}}).then((function(e){return e.json()})).then((function(e){t.textContent=e.likes.length}))};function n(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");a(t)}}function r(e){var t=document.querySelector(".popup_is-opened"),o=t.querySelector(".popup__close");e.target!=o&&e.target!=t||a(t)}var c=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n),e.addEventListener("click",r)},a=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n),e.removeEventListener("click",r)},u=/[^а-яёa-z\s\-]/i,i=document.querySelector("#popup__input_type_name"),l=document.querySelector("#popup__input_type_card-name");function s(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));e.querySelector("".concat(n.submitButtonSelector)).disabled=!0,t.classList.add("".concat(n.inputErrorClass)),r.textContent=o}function p(e,t){var o=e.querySelector("".concat(t.submitButtonSelector)),n=Array.from(e.querySelectorAll("".concat(t.errorClass))),r=Array.from(e.querySelectorAll("".concat(t.inputSelector)));o.textContent="Сохранить",o.disabled=!0,n.forEach((function(e){e.textContent=""})),r.forEach((function(e){e.classList.remove("".concat(t.inputErrorClass))}))}var d={baseUrl:"https://nomoreparties.co/v1/wff-cohort-6",headers:{authorization:"14623f3a-7681-4149-84a8-6e2abb29c429","Content-Type":"application/json"}},f=document.querySelector(".page"),_=f.querySelector(".profile__title"),y=f.querySelector(".profile__description"),h=f.querySelector(".profile__image"),m=f.querySelector(".places__list"),v=f.querySelector(".popup_type_edit"),S=f.querySelector(".popup_type_new-card"),b=f.querySelector(".popup_type_avatar"),q=b.querySelector(".popup__form"),k=v.querySelector(".popup__form"),E=S.querySelector(".popup__form"),g=f.querySelector(".popup_type_image"),C=g.querySelector(".popup__image"),L=g.querySelector(".popup__caption"),x=f.querySelector(".profile__edit-button"),j=f.querySelector(".profile__add-button"),A=f.querySelector(".profile__edit-avatar"),P=f.querySelector("#popup__input_type_name"),w=f.querySelector("#popup__input_type_description"),T=f.querySelector("#popup__input_type_card-name"),U=f.querySelector("#popup__input_type_url"),z=f.querySelector("#popup__input_type_avatar"),D=f.querySelector("#card-template"),B={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_error",errorClass:"popup__error"};function N(e){C.src=e.link,C.alt=e.name,L.textContent=e.name,c(g)}!function(e){Array.from(document.querySelectorAll("".concat(e.formSelector))).forEach((function(t){!function(e,t){Array.from(e.querySelectorAll("".concat(t.inputSelector))).forEach((function(o){o.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?(function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("".concat(o.inputErrorClass)),n.textContent=""}(e,t,o),function(e,t){var o=e.querySelector("".concat(t.submitButtonSelector));o.disabled=!1,Array.from(e.querySelectorAll("".concat(t.inputSelector))).forEach((function(e){e.validity.valid||(o.disabled=!0)}))}(e,o),t!=i&&t!=l||function(e,t,o){u.test(t.value)&&s(e,t,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы.",o)}(e,t,o)):s(e,t,t.validationMessage,o)}(e,o,t)}))}))}(t,e)}))}(B),fetch("".concat(d.baseUrl,"/users/me"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){_.textContent=e.name,y.textContent=e.about,h.style.backgroundImage="url('".concat(e.avatar,"')")})).catch((function(e){console.log(e)})),fetch("".concat(d.baseUrl,"/cards"),{headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){t.forEach((function(t){var o=e(D,t,N);m.append(o)}))})).catch((function(e){console.log(e)})),k.addEventListener("submit",(function(e){e.preventDefault(),v.querySelector(".popup__button").textContent="Сохранение...",function(e,t){return fetch("".concat(d.baseUrl,"/users/me"),{method:"PATCH",headers:d.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(P,w).then((function(e){_.textContent=e.name,y.textContent=e.about,a(v),p(v,B)})).catch((function(e){console.log(e)}))})),E.addEventListener("submit",(function(t){t.preventDefault(),S.querySelector(".popup__button").textContent="Сохранение...",function(e,t){return fetch("".concat(d.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:e.value,link:t.value}),headers:d.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(T,U).then((function(t){var o=e(D,t,N);m.prepend(o),a(S),p(S,B)})).catch((function(e){console.log(e)}))})),q.addEventListener("submit",(function(e){e.preventDefault(),b.querySelector(".popup__button").textContent="Сохранение...",function(e){return fetch("".concat(d.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:e.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(z).then((function(e){h.style.backgroundImage="url('".concat(e.avatar,"')"),a(b),p(b,B)})).catch((function(e){console.log(e)}))})),x.addEventListener("click",(function(e){e.stopPropagation(),P.value=_.textContent,w.value=y.textContent,c(v),p(v,B)})),j.addEventListener("click",(function(e){e.stopPropagation(),T.value="",U.value="",c(S),p(S,B)})),A.addEventListener("click",(function(e){e.stopPropagation(),z.value="",c(b),p(b,B)}))})();